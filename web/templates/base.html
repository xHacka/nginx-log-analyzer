{{define "base"}}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{block "title" .}}Nginx Log Analyzer{{end}}</title>
  <script>
    (() => {
      try {
        const stored = localStorage.getItem('theme');
        const preferred = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', stored || preferred);
      } catch (_) {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>
  <link rel="stylesheet" href="/static/css/bulma.min.css">
  <link rel="stylesheet" href="/static/css/style.css">
  {{block "head" .}}{{end}}
</head>
<body class="page-{{.PageID}}">
  <nav class="navbar app-navbar" role="navigation" aria-label="main navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item is-size-5" href="/">Nginx Log Analyzer</a>
        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="mainNav">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div id="mainNav" class="navbar-menu">
        <div class="navbar-end">
          <a class="navbar-item{{if eq .PageID "dashboard"}} is-active{{end}}" href="/">Dashboard</a>
          <a class="navbar-item{{if eq .PageID "query"}} is-active{{end}}" href="/query">Query</a>
          {{if .UploadEnabled}}<a class="navbar-item{{if eq .PageID "upload"}} is-active{{end}}" href="/upload">Upload</a>{{end}}
          <div class="navbar-item">
            <button id="themeToggle" class="button is-small theme-toggle" type="button">Switch to Dark</button>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <section class="section{{if eq .PageID "dashboard"}} section-dashboard{{end}}">
    {{if eq .PageID "query"}}
    <div class="query-layout">
      {{block "content" .}}{{end}}
    </div>
    {{else}}
    <div class="container">
      {{block "content" .}}{{end}}
    </div>
    {{end}}
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const applyTheme = (theme) => {
        document.documentElement.setAttribute('data-theme', theme);
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
          themeToggle.textContent = theme === 'dark' ? 'Switch to Light' : 'Switch to Dark';
          themeToggle.setAttribute('aria-label', theme === 'dark' ? 'Switch to light theme' : 'Switch to dark theme');
        }
      };

      const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
      applyTheme(currentTheme);

      const burger = document.querySelector('.navbar-burger');
      if (burger) {
        burger.addEventListener('click', () => {
          const target = document.getElementById(burger.dataset.target);
          burger.classList.toggle('is-active');
          target.classList.toggle('is-active');
        });
      }

      const themeToggle = document.getElementById('themeToggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme') || 'light';
          const next = current === 'light' ? 'dark' : 'light';
          applyTheme(next);
          localStorage.setItem('theme', next);
        });
      }
    });
  </script>
</body>
</html>
{{end}}
